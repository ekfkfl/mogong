SELECT * FROM TAB;
 
Begin -- 모든 테이블 삭제
for c in (select table_name from user_tables) loop
  execute immediate 'drop table '||c.table_name||' cascade constraints';
end loop;
End;
 
Begin -- 모든 시퀀스 삭제
for c in (SELECT * FROM all_sequences WHERE SEQUENCE_OWNER='DBUSER') loop
  execute immediate 'drop SEQUENCE '||c.sequence_name;
end loop;
End;

CREATE TABLE USER_TB(
  ID VARCHAR2(30) PRIMARY KEY, -- 회원아이디 
  PASSWORD VARCHAR2(100) NOT NULL, -- 비밀번호
  NAME VARCHAR2(20) NOT NULL, -- 이름
  PATH VARCHAR2(500) NOT NULL, -- 사진 경로
  GENDER VARCHAR2(30) NOT NULL, -- 성별
  BIRTH VARCHAR2(50) NOT NULL, -- 생년월일
  ADDR VARCHAR2(300), -- 주소
  PHONE VARCHAR2(30) NOT NULL, -- 전화번호
  EMAIL VARCHAR2(40) NOT NULL, -- 이메일
  INTRO VARCHAR2(500) NOT NULL, -- 자기소개
  LOGIN_STATUS VARCHAR2(10), -- 로그인상태
  USER_TYPE VARCHAR2(30) NOT NULL -- 역할
)

CREATE TABLE COMM_CODE(
  COMM_CODE VARCHAR2(10) PRIMARY KEY, -- 공통코드번호
  CODE_NAME VARCHAR2(40) NOT NULL, -- 코드이름
  CODE_DESC VARCHAR2(100),  --코드설명
  PARENT_CODE VARCHAR2(6), --부모코드
  REG_DATE DATE NOT NULL, --등록일
  UPDATE_DATE DATE, --수정일
  CODE_USED VARCHAR2(1) DEFAULT 'Y', --공통코드 사용유무
  CODE_ORDER NUMBER(3) --코드 순서 
);
 
CREATE TABLE STUDY(
  STUDY_CODE NUMBER PRIMARY KEY, -- 스터디 코드
  ID VARCHAR2(30) REFERENCES USER_TB(ID), -- 회원 아이디
  CATEGORY_CODE VARCHAR2(30) REFERENCES COMM_CODE(COMM_CODE), -- 카테고리 코드(공통코드에서 가져옴)
  CITY_CODE VARCHAR2(30) REFERENCES COMM_CODE(COMM_CODE), -- 도시 코드(공통코드에서 가져옴)
  NAME VARCHAR2(100) NOT NULL, -- 스터디 이름
  WRITE_DATE DATE NOT NULL, -- 등록일
  START_DATE DATE NOT NULL, -- 시작일
  END_DATE DATE NOT NULL, -- 종료일
  DAY VARCHAR2(30) NOT NULL, -- 요일
  START_TIME VARCHAR2(30) NOT NULL, -- 시작시간
  END_TIME VARCHAR2(30) NOT NULL, -- 종료시간
  PEOPLE NUMBER NOT NULL, -- 인원
  AREA VARCHAR2(50) NOT NULL, -- 지역
  DESCRIPTION VARCHAR2(500) NOT NULL, -- 스터디 설명
  READ NUMBER DEFAULT 1, -- 조회수
  STUDY_STATUS VARCHAR2(10) REFERENCES COMM_CODE(COMM_CODE) -- 스터디 상태(모집중,진행중..)
)

CREATE SEQUENCE STUDY_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOMINVALUE

CREATE TABLE MEMBER(
  MEMBER_CODE NUMBER PRIMARY KEY,
  STUDY_CODE NUMBER REFERENCES STUDY(STUDY_CODE),
  ID VARCHAR2(30) REFERENCES USER_TB(ID),
  JOIN_STATUS VARCHAR2(10) REFERENCES COMM_CODE(COMM_CODE), -- 가입상태
  GRADE VARCHAR2(10) REFERENCES COMM_CODE(COMM_CODE) -- 등급
)
 
CREATE SEQUENCE MEMBER_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOMINVALUE
 
CREATE TABLE TASK(
  TASK_CODE NUMBER PRIMARY KEY,
  STUDY_CODE NUMBER REFERENCES STUDY(STUDY_CODE),
  TITLE VARCHAR2(100) NOT NULL, -- 태스크 제목
  CONTENT VARCHAR2(300), -- 태스크 내용
  PROGRESS_STATUS VARCHAR2(10) REFERENCES COMM_CODE(COMM_CODE), -- 진행상태
  START_DATE DATE, --시작일
  END_DATE DATE, -- 종료일 
  SUCCESS_DATE DATE, -- 완료일
  CREATE_DATE DATE, -- 등록일
  UPDATE_DATE DATE, -- 수정일
  TASK_INDEX NUMBER -- 태스크 순서
) 

CREATE SEQUENCE TASK_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOMINVALUE
 
CREATE TABLE TASK_FILE(
  TASK_FILE_CODE NUMBER PRIMARY KEY,
  TASK_CODE NUMBER REFERENCES TASK(TASK_CODE) ON DELETE CASCADE,
  ID VARCHAR2(30) REFERENCES USER_TB(ID),
  NAME VARCHAR2(20),
  FILENAME VARCHAR2(50) NOT NULL, -- 태스크 파일명
  PATH VARCHAR2(500) NOT NULL, -- 태스크 파일경로
  FILESIZE NUMBER NOT NULL, -- 태스크 파일크기
  WRITE_DATE DATE NOT NULL -- 태스크 파일 등록일
)
 
CREATE SEQUENCE TASK_FILE_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOMINVALUE
 
CREATE TABLE TASK_COMMENT(
  TASK_COMMENT_CODE NUMBER PRIMARY KEY, 
  TASK_CODE NUMBER REFERENCES TASK(TASK_CODE) ON DELETE CASCADE,
  ID VARCHAR2(30) REFERENCES USER_TB(ID), -- 아이디
  NAME VARCHAR2(20), -- 이름
  PATH VARCHAR2(500), -- 사진 경로
  CONTENT VARCHAR2(300) NOT NULL, -- 태스크 코멘트 내용
  WRITE_DATE DATE NOT NULL -- 태스크 코멘트 등록일
)
 
CREATE SEQUENCE TASK_COMMENT_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOMINVALUE

CREATE TABLE TASK_MEMBER( -- 태스크를 할당받은 멤버 테이블
  TASK_CODE NUMBER REFERENCES TASK(TASK_CODE) ON DELETE CASCADE, 
  MEMBER_CODE NUMBER REFERENCES MEMBER(MEMBER_CODE) ON DELETE CASCADE,
  CONSTRAINT TASK_MEMBER_PK PRIMARY KEY(TASK_CODE,MEMBER_CODE)   
)

CREATE TABLE SEND_MESSAGE(
  SEND_MESSAGE_CODE NUMBER PRIMARY KEY,
  ID VARCHAR2(30) REFERENCES USER_TB(ID), -- 보낸 회원 ID
  TITLE VARCHAR2(50) NOT NULL, -- 제목
  CONTENT VARCHAR2(500) NOT NULL,  -- 내용
  RECV_ID VARCHAR2(30) NOT NULL, -- 받는 회원 ID
  WRITE_DATE DATE NOT NULL, -- 작성일
  STUDY_CODE NUMBER,
  JOIN_STATUS VARCHAR2(10) REFERENCES COMM_CODE(COMM_CODE), -- 가입상태
)
 
CREATE SEQUENCE SEND_MESSAGE_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOMINVALUE
 
CREATE TABLE RECV_MESSAGE(
  RECV_MESSAGE_CODE NUMBER PRIMARY KEY,
  ID VARCHAR2(30) REFERENCES USER_TB(ID), -- 받는 회원 ID
  TITLE VARCHAR2(50) NOT NULL,
  CONTENT VARCHAR2(500) NOT NULL,
  SEND_ID VARCHAR2(30) NOT NULL, -- 보낸 회원 ID
  WRITE_DATE DATE NOT NULL,
  CONFIRM VARCHAR2(10) REFERENCES COMM_CODE(COMM_CODE), -- 받은 쪽지 확인 유무
  STUDY_CODE NUMBER,
  JOIN_STATUS VARCHAR2(10) REFERENCES COMM_CODE(COMM_CODE), -- 가입상태
)
 
CREATE SEQUENCE RECV_MESSAGE_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOMINVALUE
 
 
CREATE TABLE BOARD(
  BOARD_CODE NUMBER PRIMARY KEY,
  STUDY_CODE NUMBER REFERENCES STUDY(STUDY_CODE),
  MEMBER_CODE NUMBER REFERENCES MEMBER(MEMBER_CODE),
  TITLE VARCHAR2(30) NOT NULL,
  CONTENT VARCHAR2(500) NOT NULL,
  WRITE_DATE DATE NOT NULL,
  HIT NUMBER,
  FILENAME VARCHAR2(50),
  NOTICE VARCHAR2(5)
)
 
CREATE SEQUENCE BOARD_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOMINVALUE
 
CREATE TABLE CHAT(
  CHAT_CODE NUMBER PRIMARY KEY,
  STUDY_CODE NUMBER REFERENCES STUDY(STUDY_CODE),
  MEMBER_CODE NUMBER REFERENCES MEMBER(MEMBER_CODE),
  CONTENT VARCHAR2(500) NOT NULL,
  WRITE_DATE DATE NOT NULL
)
 
CREATE SEQUENCE CHAT_SEQ
START WITH 1
INCREMENT BY 1
NOMAXVALUE
NOMINVALUE
  
CREATE TABLE BOARD_COMMENT(
  COMMENT_CODE NUMBER PRIMARY KEY,
  BOARD_CODE NUMBER REFERENCES BOARD(BOARD_CODE),
  MEMBER_CODE NUMBR REFERENCES MEMBER(MEMBER_CODE),
  CONTENT VARCHAR2(1000),
  WRITE_DATE VARCHAR2(10),
  STUDY_CODE NUMBER
)

COMMIT